<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å±‹æ ¹è‘ºãæ›¿ãˆæ¦‚ç®—è¦‹ç©ã‚‚ã‚Š</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Hiragino Sans', 'Meiryo', sans-serif; background: #f5f5f5; color: #2c2c2c; }

  /* ç”»é¢è¡¨ç¤ºç”¨ */
  .page-header {
    background: #2c2c2c; color: white; padding: 20px;
    display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
  }
  .page-header h1 { font-size: 1.2rem; flex: 1; }
  .page-header a { color: #aaa; font-size: 0.85rem; text-decoration: none; }
  .page-header a:hover { color: white; }

  .container { max-width: 900px; margin: 24px auto; padding: 0 16px 60px; }

  .card {
    background: white; border-radius: 8px; padding: 20px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1); margin-bottom: 20px;
  }
  .card h2 { font-size: 1rem; margin-bottom: 14px; padding-bottom: 8px; border-bottom: 2px solid #2c2c2c; }

  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  @media (max-width: 480px) { .form-grid { grid-template-columns: 1fr; } }

  .form-group { display: flex; flex-direction: column; gap: 4px; }
  .form-group label { font-size: 0.85rem; color: #666; }
  .form-group input, .form-group select, .form-group textarea {
    padding: 8px 10px; border: 1px solid #ccc; border-radius: 4px;
    font-size: 0.95rem; font-family: inherit;
  }
  .form-group input:focus, .form-group select:focus {
    outline: none; border-color: #007bff;
  }

  /* å±‹æ ¹ç¨®é¡ã‚¿ãƒ– */
  .roof-tabs { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 16px; }
  .roof-tab {
    padding: 6px 14px; border: 2px solid #ccc; border-radius: 20px;
    background: white; cursor: pointer; font-size: 0.85rem; color: #666;
    transition: all 0.15s;
  }
  .roof-tab.active { border-color: #007bff; background: #007bff; color: white; }

  /* å˜ä¾¡è¨­å®šãƒ†ãƒ¼ãƒ–ãƒ« */
  .unit-table { width: 100%; border-collapse: collapse; font-size: 0.88rem; }
  .unit-table th { background: #f0f0f0; padding: 8px 10px; text-align: left; font-weight: normal; color: #555; }
  .unit-table td { padding: 6px 8px; border-bottom: 1px solid #eee; }
  .unit-table input {
    width: 100%; padding: 5px 8px; border: 1px solid #ddd; border-radius: 3px;
    font-size: 0.88rem; text-align: right;
  }
  .unit-table input:focus { outline: none; border-color: #007bff; }

  /* å…±é€šè²»ç”¨ */
  .common-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }

  /* çµæœè¡¨ç¤º */
  .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 14px; margin-bottom: 16px; }
  .result-card {
    border: 2px solid #e0e0e0; border-radius: 8px; overflow: hidden;
  }
  .result-card.highlight { border-color: #007bff; }
  .result-card-header {
    background: #f7f7f7; padding: 10px 14px; font-size: 0.9rem; font-weight: bold;
  }
  .result-card.highlight .result-card-header { background: #007bff; color: white; }
  .result-card-body { padding: 10px 14px; }
  .result-row { display: flex; justify-content: space-between; font-size: 0.85rem; padding: 3px 0; border-bottom: 1px solid #f0f0f0; }
  .result-row:last-child { border-bottom: none; }
  .result-total { display: flex; justify-content: space-between; font-size: 1rem; font-weight: bold; padding: 8px 14px; background: #f9f9f9; border-top: 2px solid #e0e0e0; }
  .result-card.highlight .result-total { background: #e8f0fe; }

  .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.95rem; font-family: inherit; }
  .btn-primary { background: #007bff; color: white; }
  .btn-primary:hover { background: #0056b3; }
  .btn-secondary { background: #555; color: white; }
  .btn-secondary:hover { background: #333; }
  .btn-print { background: #2c2c2c; color: white; }
  .btn-print:hover { background: #444; }

  .btn-row { display: flex; gap: 10px; flex-wrap: wrap; }

  .note { font-size: 0.8rem; color: #999; margin-top: 8px; }

  /* ===== å°åˆ·ç”¨ã‚¹ã‚¿ã‚¤ãƒ« ===== */
  @media print {
    body { background: white; font-size: 11pt; }
    .no-print { display: none !important; }
    .page-header { background: #2c2c2c !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; padding: 12px 20px; }
    .container { max-width: 100%; margin: 0; padding: 10px; }
    .card { box-shadow: none; border: 1px solid #ddd; page-break-inside: avoid; }
    .result-grid { grid-template-columns: repeat(4, 1fr); }
    .result-card-header { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .result-card.highlight .result-card-header { background: #007bff !important; color: white !important; }
    .result-card.highlight .result-total { background: #e8f0fe !important; }
    .print-only { display: block !important; }
  }
  .print-only { display: none; }
</style>
</head>
<body>

<div class="page-header no-print">
  <div>
    <a href="javascript:history.back()">â† åœ°å›³ã‚¢ãƒ—ãƒªã«æˆ»ã‚‹</a>
    <h1>ğŸ  å±‹æ ¹è‘ºãæ›¿ãˆæ¦‚ç®—è¦‹ç©ã‚‚ã‚Š</h1>
  </div>
</div>

<div class="print-only" style="padding: 12px 20px; background: #2c2c2c; color: white;">
  <h1 style="font-size: 1.1rem;">å±‹æ ¹è‘ºãæ›¿ãˆæ¦‚ç®—è¦‹ç©ã‚‚ã‚Š</h1>
</div>

<div class="container">

  <!-- åŸºæœ¬æƒ…å ± -->
  <div class="card no-print">
    <h2>ğŸ“‹ åŸºæœ¬æƒ…å ±</h2>
    <div class="form-grid">
      <div class="form-group">
        <label>ç‰©ä»¶åãƒ»ä½æ‰€</label>
        <input type="text" id="property-name" placeholder="ä¾‹ï¼šå±±ç”°æ§˜é‚¸">
      </div>
      <div class="form-group">
        <label>å±‹æ ¹é¢ç©ï¼ˆmÂ²ï¼‰</label>
        <input type="number" id="roof-area" placeholder="ä¾‹ï¼š120" min="1">
      </div>
      <div class="form-group">
        <label>ä½œæˆæ—¥</label>
        <input type="date" id="estimate-date">
      </div>
      <div class="form-group">
        <label>æ‹…å½“è€…</label>
        <input type="text" id="staff-name" placeholder="ä¾‹ï¼šé•·è°·å·å¤§æ¨¹">
      </div>
    </div>
  </div>

  <!-- å±‹æ ¹ç¨®é¡ã®å˜ä¾¡è¨­å®š -->
  <div class="card no-print">
    <h2>ğŸ”§ å±‹æ ¹ç¨®é¡ãƒ»å˜ä¾¡è¨­å®š</h2>
    <div class="roof-tabs" id="roof-tabs"></div>
    <div id="unit-panels"></div>
  </div>

  <!-- å…±é€šè²»ç”¨ -->
  <div class="card no-print">
    <h2>ğŸ’° å…±é€šè²»ç”¨</h2>
    <div class="common-grid">
      <div class="form-group">
        <label>è¶³å ´ä»£ï¼ˆå††ï¼‰</label>
        <input type="number" id="scaffold" value="150000" min="0">
      </div>
      <div class="form-group">
        <label>å»ƒæå‡¦åˆ†è²»ï¼ˆå††ï¼‰</label>
        <input type="number" id="disposal" value="50000" min="0">
      </div>
      <div class="form-group">
        <label>è«¸çµŒè²»ç‡ï¼ˆ%ï¼‰</label>
        <input type="number" id="overhead" value="10" min="0" max="100" step="0.5">
      </div>
    </div>
    <p class="note">â€» è«¸çµŒè²»ã¯ï¼ˆææ–™è²»ï¼‹æ–½å·¥è²»ï¼‹è¶³å ´ï¼‹å»ƒæï¼‰ã«å¯¾ã—ã¦åŠ ç®—ã•ã‚Œã¾ã™</p>
  </div>

  <!-- è¨ˆç®—ãƒœã‚¿ãƒ³ -->
  <div class="btn-row no-print" style="margin-bottom: 20px;">
    <button class="btn btn-primary" onclick="calculate()">ğŸ“Š æ¦‚ç®—ã‚’è¨ˆç®—ã™ã‚‹</button>
  </div>

  <!-- çµæœ -->
  <div id="result-section" style="display:none;">
    <div class="card">
      <h2 id="result-title">ğŸ“„ æ¦‚ç®—è¦‹ç©ã‚‚ã‚Šæ¯”è¼ƒ</h2>

      <!-- å°åˆ·æ™‚ã®ã¿è¡¨ç¤ºã™ã‚‹åŸºæœ¬æƒ…å ± -->
      <div class="print-only" style="margin-bottom: 16px; font-size: 0.9rem; display: flex; gap: 40px; flex-wrap: wrap;">
        <div><strong>ç‰©ä»¶åï¼š</strong><span id="print-property"></span></div>
        <div><strong>å±‹æ ¹é¢ç©ï¼š</strong><span id="print-area"></span> mÂ²</div>
        <div><strong>ä½œæˆæ—¥ï¼š</strong><span id="print-date"></span></div>
        <div><strong>æ‹…å½“è€…ï¼š</strong><span id="print-staff"></span></div>
      </div>

      <div class="result-grid" id="result-grid"></div>

      <p class="note">â€» ã“ã®é‡‘é¡ã¯ã‚ãã¾ã§æ¦‚ç®—ã§ã™ã€‚ç¾åœ°èª¿æŸ»å¾Œã«æ­£å¼ãªãŠè¦‹ç©ã‚‚ã‚Šã‚’ã”ææ¡ˆã„ãŸã—ã¾ã™ã€‚</p>
    </div>

    <div class="btn-row no-print">
      <button class="btn btn-print" onclick="printEstimate()">ğŸ–¨ï¸ PDFãƒ»å°åˆ·ã™ã‚‹</button>
      <button class="btn btn-secondary" onclick="calculate()">å†è¨ˆç®—</button>
    </div>
  </div>

</div>

<script>
// ===== å±‹æ ¹ç¨®é¡ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š =====
const roofTypes = [
  {
    id: 'honbuki',
    name: 'å’Œç“¦ï¼ˆæœ¬è‘ºãï¼‰',
    materialUnit: 8000,   // å††/mÂ²
    laborUnit: 6000,      // å††/mÂ²
  },
  {
    id: 'sanbuki',
    name: 'å’Œç“¦ï¼ˆæ¡Ÿè‘ºãï¼‰',
    materialUnit: 6000,
    laborUnit: 4500,
  },
  {
    id: 'galtect',
    name: 'ã‚¬ãƒ«ãƒ†ã‚¯ãƒˆ',
    materialUnit: 5500,
    laborUnit: 3500,
  },
  {
    id: 'tatebiraki',
    name: 'ç«‹å¹³è‘ºã',
    materialUnit: 4500,
    laborUnit: 3000,
  },
];

// ===== ã‚¿ãƒ–ã¨ãƒ‘ãƒãƒ«ã‚’ç”Ÿæˆ =====
function buildUI() {
  const tabsEl = document.getElementById('roof-tabs');
  const panelsEl = document.getElementById('unit-panels');

  roofTypes.forEach((roof, i) => {
    // ã‚¿ãƒ–
    const tab = document.createElement('div');
    tab.className = 'roof-tab' + (i === 0 ? ' active' : '');
    tab.textContent = roof.name;
    tab.dataset.id = roof.id;
    tab.onclick = () => switchTab(roof.id);
    tabsEl.appendChild(tab);

    // ãƒ‘ãƒãƒ«
    const panel = document.createElement('div');
    panel.id = `panel-${roof.id}`;
    panel.style.display = i === 0 ? 'block' : 'none';
    panel.innerHTML = `
      <table class="unit-table">
        <thead>
          <tr>
            <th>é …ç›®</th>
            <th>å˜ä¾¡ï¼ˆå††/mÂ²ï¼‰</th>
            <th>å‚™è€ƒ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ææ–™è²»</td>
            <td><input type="number" id="mat-${roof.id}" value="${roof.materialUnit}" min="0"></td>
            <td style="font-size:0.8rem; color:#999;">Ã— å±‹æ ¹é¢ç©</td>
          </tr>
          <tr>
            <td>æ–½å·¥è²»ï¼ˆå·¥è³ƒï¼‰</td>
            <td><input type="number" id="lab-${roof.id}" value="${roof.laborUnit}" min="0"></td>
            <td style="font-size:0.8rem; color:#999;">Ã— å±‹æ ¹é¢ç©</td>
          </tr>
        </tbody>
      </table>
    `;
    panelsEl.appendChild(panel);
  });
}

function switchTab(id) {
  document.querySelectorAll('.roof-tab').forEach(t => t.classList.remove('active'));
  document.querySelector(`.roof-tab[data-id="${id}"]`).classList.add('active');
  roofTypes.forEach(r => {
    document.getElementById(`panel-${r.id}`).style.display = r.id === id ? 'block' : 'none';
  });
}

// ===== è¨ˆç®— =====
function calculate() {
  const area = parseFloat(document.getElementById('roof-area').value);
  if (!area || area <= 0) { alert('å±‹æ ¹é¢ç©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); return; }

  const scaffold = parseFloat(document.getElementById('scaffold').value) || 0;
  const disposal = parseFloat(document.getElementById('disposal').value) || 0;
  const overheadRate = parseFloat(document.getElementById('overhead').value) || 0;

  // å°åˆ·ç”¨åŸºæœ¬æƒ…å ±
  document.getElementById('print-property').textContent = document.getElementById('property-name').value || 'â€”';
  document.getElementById('print-area').textContent = area;
  document.getElementById('print-date').textContent = document.getElementById('estimate-date').value || 'â€”';
  document.getElementById('print-staff').textContent = document.getElementById('staff-name').value || 'â€”';

  const grid = document.getElementById('result-grid');
  grid.innerHTML = '';

  // æœ€å®‰å€¤ã‚’æ¢ã—ã¦ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  const totals = roofTypes.map(roof => {
    const mat = (parseFloat(document.getElementById(`mat-${roof.id}`).value) || 0) * area;
    const lab = (parseFloat(document.getElementById(`lab-${roof.id}`).value) || 0) * area;
    const sub = mat + lab + scaffold + disposal;
    const overhead = Math.round(sub * overheadRate / 100);
    return Math.round(sub + overhead);
  });
  const minTotal = Math.min(...totals);

  roofTypes.forEach((roof, i) => {
    const mat = Math.round((parseFloat(document.getElementById(`mat-${roof.id}`).value) || 0) * area);
    const lab = Math.round((parseFloat(document.getElementById(`lab-${roof.id}`).value) || 0) * area);
    const sub = mat + lab + scaffold + disposal;
    const overhead = Math.round(sub * overheadRate / 100);
    const total = Math.round(sub + overhead);
    const isMin = total === minTotal;

    const card = document.createElement('div');
    card.className = 'result-card' + (isMin ? ' highlight' : '');
    card.innerHTML = `
      <div class="result-card-header">
        ${isMin ? 'â˜… ' : ''}${roof.name}
      </div>
      <div class="result-card-body">
        <div class="result-row"><span>ææ–™è²»</span><span>${fmt(mat)}å††</span></div>
        <div class="result-row"><span>æ–½å·¥è²»</span><span>${fmt(lab)}å††</span></div>
        <div class="result-row"><span>è¶³å ´ä»£</span><span>${fmt(scaffold)}å††</span></div>
        <div class="result-row"><span>å»ƒæå‡¦åˆ†è²»</span><span>${fmt(disposal)}å††</span></div>
        <div class="result-row"><span>è«¸çµŒè²»(${overheadRate}%)</span><span>${fmt(overhead)}å††</span></div>
      </div>
      <div class="result-total">
        <span>åˆè¨ˆï¼ˆç¨æŠœï¼‰</span>
        <span>${fmt(total)}å††</span>
      </div>
    `;
    grid.appendChild(card);
  });

  document.getElementById('result-section').style.display = 'block';
  document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
}

function fmt(n) {
  return n.toLocaleString('ja-JP');
}

function printEstimate() {
  window.print();
}

// ===== åˆæœŸåŒ– =====
buildUI();

// ä»Šæ—¥ã®æ—¥ä»˜ã‚’ã‚»ãƒƒãƒˆ
document.getElementById('estimate-date').value = new Date().toISOString().split('T')[0];

// URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰å±‹æ ¹é¢ç©ã‚’å—ã‘å–ã‚‹ï¼ˆåœ°å›³ã‚¢ãƒ—ãƒªã‹ã‚‰é€£æºï¼‰
const params = new URLSearchParams(window.location.search);
if (params.get('area')) {
  document.getElementById('roof-area').value = params.get('area');
}
if (params.get('address')) {
  document.getElementById('property-name').value = decodeURIComponent(params.get('address'));
}
</script>
</body>
</html>
